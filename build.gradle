import groovy.io.FileType

// now run
// groovy dependencies.groovy '.*acquisition.*' && dot tmp.gv -Tsvg > tmp.svg

task createDependencyGraph << {
	List<File> pomFiles = []
	new File(rootDirOfProjectToSearch).eachFile(FileType.DIRECTORIES) { module ->
	    pomFiles << new File(module.absolutePath + '/pom.xml')
	}

	def dependenciesGroupedByModule = new MavenDependencyRetriever().parseMatchingDependenciesFromPoms(pomFiles, dependencyRegex)
	def graphEntries = new DependencyToDotLanguageTranslator().translateDependenciesToDotLanguage(dependenciesGroupedByModule)

	File graphDotFile = new File("tmp.gv")
	new GraphvizDotfileCreator().createDirectedGraphFile(graphDotFile, graphEntries)
}
